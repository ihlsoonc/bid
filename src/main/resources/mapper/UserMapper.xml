<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bidsystem.bid.mapper.UserMapper">

    <!-- 사용자 정보 조회 (ID 또는 전화번호로) -->
    <select id="getUserByQuery" parameterType="hashmap" resultType="hashmap">
        SELECT * 
        FROM biduser 
        WHERE userid = #{query} OR telno = #{query}
    </select>

    <select id="getUserById" parameterType="hashmap" resultType="hashmap">
        SELECT * 
        FROM biduser
        WHERE userid = #{userId}
    </select>

    <!-- 사용자 ID 조회 (이메일과 이름으로) -->
    <select id="getUserIdByEmailAndName" parameterType="hashmap" resultType="hashmap">
        SELECT userid FROM biduser WHERE email = #{email} AND username = #{userName}
    </select>

    <!-- 전화번호로 사용자 ID 조회 -->
    <select id="getUserByTelno" parameterType="hashmap" resultType="hashmap">
        SELECT * FROM biduser WHERE telno = #{telno}
    </select>

    <!-- 사용자 등록 -->
    <insert id="registerUser" parameterType="hashmap">
        INSERT INTO biduser (userid, password, username, email, telno, postcode, addr1, addr2, createdat)
        VALUES (#{userId}, #{password}, #{userName}, #{email}, #{telno}, #{postCode}, #{addr1}, #{addr2}, CURRENT_TIMESTAMP)
    </insert>

    <!-- 사용자 정보 수정 CamelCase가 아님을 유의 --> 
    <update id="updateUser" parameterType="hashmap">
        UPDATE biduser
        <set>
            <if test="username != null"> username = #{username}, </if>
            <if test="email != null"> email = #{email}, </if>
            <if test="telno != null"> telno = #{telno}, </if>
            <if test="postcode != null"> postcode = #{postcode}, </if>
            <if test="addr1 != null"> addr1 = #{addr1}, </if>
            <if test="addr2 != null"> addr2 = #{addr2} </if>
        </set>
        WHERE userid = #{userid}
    </update>

    <!-- 비밀번호 변경 -->
    <update id="changePassword" parameterType="hashmap">
        UPDATE biduser
        SET password = #{newPassword}
        WHERE userid = #{userId}
    </update>

</mapper>
